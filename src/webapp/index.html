<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Tetonor web app</title>
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="node_modules/font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" href="style/app.css" />
    <link rel="stylesheet" href="style/tetonor.css" />

    <script type="x-template" id="tetonor-input">
            <div class="equation-input"
                    :class="{'empty-input': !value}"
                    @click="clearValue"
                    @drop="dropChoice"
                    @dragover="dragChoice">
                <span v-if="value != null">
                    {{value}}
                </span>
            </div>
        </script>
</head>

<body>
    <header>
        <h1>Tetonor!</h1>
    </header>

    <main>
        <div id="app" v-cloak>
            <div v-if="game.status == GAME_STATUS.CHOOSE">
                <choose-game :games="games" inline-template>
                    <div>
                        <div>Games list</div>
                        <ul>
                            <li v-for="game in games">
                                <a @click="chooseGame(game)" :class="{ game_waiting : game.status == GAME_STATUS.WAITING_PEER}">
                                    {{game.id}} Players: {{game.players}}/{{game.minPlayerCount}} ({{status(game.status)}})
                                </a>

                            </li>
                        </ul>
                        <br />
                        <div>Add game:</div>
                        <input v-model="gameName" placeholder="Game name" />
                        <div>Add game:</div>
                        <input v-model="players" type="number" placeholder="Number of players" />
                        <br />
                        <button @click="createGame()">Create</button>
                    </div>
                </choose-game>
            </div>

            <div v-if="game.status == GAME_STATUS.JOIN">
                <join-game inline-template>
                    <div>
                        <div>Enter you username:</div>
                        <input v-model="username" placeholder="Enter the your name" />
                        <br />
                        <div>Choose the game to join:</div>
                        <input v-model="gameName" readonly="readonly" />
                        <br />
                        <button @click="joinGame()">Join</button>
                    </div>
                </join-game>
            </div>

            <div v-if="game.status == GAME_STATUS.WAITING_PEER">
                Waiting peer!
            </div>

            <div v-if="game.status == GAME_STATUS.PLAYING">
                <tetonor inline-template :board="board" :game="game">
                    <div class="tetonor" :class="{dragging: dragging}">
                        <div class="board">
                            <div class="problem-grid">
                                <problem inline-template v-for="(problem, index) in board.problems" :board-problem="problem"
                                    :key="index" :choices="board.choices" @updated="problemUpdated(problem)">
                                    <div class="problem" :class="correctness">
                                        <div class="result">
                                            {{ problem.res }}
                                        </div>
                                        <div class="equation">
                                            <tetonor-input :input="problem.inputA" :choices="choices" @updated="equationUpdated(problem)"></tetonor-input>
                                            <div class="equation-operator" @click="toggleOperator(problem)">
                                                {{ problem.operator }}
                                            </div>
                                            <tetonor-input :input="problem.inputB" :choices="choices" @updated="equationUpdated(problem)"></tetonor-input>
                                        </div>
                                    </div>
                                </problem>
                            </div>
                        </div>
                        <div class="scores-list">
                            <span class="scores-list-title">Player list</span>
                            <div class="player-list">
                                <div class="player" v-for="player in game.players" :connected="player.connected">
                                    <div class="player-name">
                                        {{ player.user }}
                                    </div>
                                    <div class="progress player-score">
                                        <div class="progress-bar" role="progressbar" :style="{ width: player.score + '%'}"
                                            aria-valuemin="0" aria-valuemax="100">
                                            {{ player.score }}%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="choices-container">
                            <div class="choices">
                                <div class="choice" v-for="(choice, index) in board.choices" :draggable="choice.val && choice.available != 0"
                                    :class="{'empty-input': !choice.val, unavailable: !choice.available}" @dragstart="dragstart(index, $event)"
                                    @dragend="dragend">
                                    {{ choice.val }}
                                </div>
                            </div>
                        </div>
                    </div>
                </tetonor>
            </div>

            <div v-if="game.status == GAME_STATUS.OVER">
                Result: {{game.winner?'WON':'LOST'}}
            </div>

        </div>
    </main>

    <footer>
        <a target="_blank" class="bug" href="https://github.com/claudiosousa/tetonor/issues/new">
            Report a bug
        </a>
    </footer>
    <script src="node_modules/jquery/dist/jquery.min.js"></script>
    <script src="node_modules/lodash/lodash.min.js"></script>
    <script src="node_modules/vue/dist/vue.js"></script>

    <script src="app.js" type="module"></script>
</body>

</html>